MEDIA 模型分割与并行性分析完整总结

本文基于论文《DNN Partitioning and Assignment for Distributed Inference in SGX Empowered Edge Cloud》，
系统总结并扩展分析了 MEDIA（Memory-aware Distributed Inference Acceleration）算法，重点补充了其在模型分割阶段对并行性的考虑方式。

==============================
一、问题背景与建模
==============================
1. 深度神经网络（DNN）被建模为有向无环图（DAG），节点表示网络层，边表示数据依赖。
2. 分布式推理运行在多个 SGX 边缘节点上，每个分区在单节点内顺序执行。
3. EPC（Enclave Page Cache）内存容量有限，超过后将引发页交换并导致显著性能退化。
4. 研究目标是在保证安全执行的前提下，最小化端到端推理时延。

==============================
二、MEDIA 的整体算法框架
==============================
MEDIA 算法由两个核心阶段构成：
1）模型分割（Partitioning）：确定模型的粗粒度分区；
2）分区分配（Assignment）：将分区调度至不同服务器并执行。

本文重点关注模型分割阶段及其对模型并行性的影响。

==============================
三、模型分割阶段（Partitioning）
==============================

（一）Edge Selection：并行结构保护机制
----------------------------------
MEDIA 首先在原始 DAG 上执行边选择操作，仅允许满足以下条件的边被选入候选合并集合 M：
1. 边的起点节点仅有一个后继；或
2. 边的终点节点仅有一个前驱。

该约束确保：
- 分支（fork）与汇聚（join）节点附近的结构不会被轻易合并；
- 原始模型中的并行分支拓扑得以保留；
- 合并操作不会破坏 DAG 的无环性。

因此，MEDIA 虽未显式建模并行性指标，但在结构层面避免了对并行性的破坏。

（二）Memory-aware Partitioning：并行性与 EPC 约束的权衡
--------------------------------------------------
在候选边集合 M 上，MEDIA 逐步尝试合并相邻分区，并通过 Check(P, P') 函数判断是否合并：
1. 若合并后内存占用不超过 EPC，则直接合并；
2. 若超过 EPC，但合并后的执行时间（含页交换）仍小于“分开执行 + 通信时间”，则允许合并；
3. 否则拒绝合并。

该策略的结果是：
- 对线性结构模型，倾向于形成较大分区；
- 对具有并行分支的模型，在 EPC 压力与通信代价权衡下，更可能保留多个可并行执行的中等规模分区。

并行性在此阶段并非优化目标，而是作为合并决策中的“隐含约束”被间接保护。

==============================
四、MEDIA 是否显式考虑模型并行性？
==============================
结论如下：
- MEDIA 在模型分割阶段未显式引入并行性优化目标；
- 未直接最小化关键路径长度或最大化并行宽度；
- 模型并行性并非分割算法的显式决策变量。

但通过：
1）严格的 DAG 合并规则；
2）内存感知的合并判定；
MEDIA 在实践中保留了原始模型中具备性能收益的并行结构。

==============================
五、并行性真正发挥作用的阶段：Assignment
==============================
在分区分配阶段，MEDIA：
1. 计算每个分区的优先级（基于关键路径思想）；
2. 按优先级顺序调度分区；
3. 将无依赖的分区分配至不同服务器并行执行。

因此可以总结为：
- 分割阶段：并行性被结构性保留；
- 分配阶段：并行性被调度策略释放并转化为性能收益。

==============================
六、算法特点总结
==============================
1. EPC 并非硬约束，而是性能模型的一部分；
2. 分割粒度由“整体执行是否更快”决定；
3. 并行性通过 DAG 约束被隐式保护；
4. 适用于 SGX 边缘云的大模型安全推理场景。

==============================
七、可扩展研究方向
==============================
MEDIA 可进一步扩展为：
- 并行性感知的分割算法（Parallelism-aware MEDIA）；
- 在 Check() 中引入并行性收益项；
- 结合关键路径最小化的多目标分割模型。

